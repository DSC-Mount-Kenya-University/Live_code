<script src="//code.jquery.com/jquery-1.11.1.min.js"></script>
<link
href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css"
rel="stylesheet"
integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1"
crossorigin="anonymous"
/>

<link rel="stylesheet" href="../../CSS/styles.css" />   
<!------ Include the above in your HEAD tag ---------->

<link
  href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css"
  rel="stylesheet"
  integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1"
  crossorigin="anonymous"
/>
<link
  rel="stylesheet"
  href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/default.min.css"
/>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
<script>
  hljs.initHighlightingOnLoad();
</script>


<body class="home">

  <div class="container-fluid display-table">
    <div class="row display-table-row">
      <div
        class="col-md-2 col-sm-1 hidden-xs display-table-cell v-align box"
        id="navigation"
      >
        <div class="navi">
          <ul>
            <% files.forEach(function(file){%>
            <li class="active">
              <a href="#" onclick="loadCode(this)"
                ><i class="<%=file.icon%>" aria-hidden="true"></i
                ><span class="hidden-xs hidden-sm"><%=file.filename%></span></a
              >
            </li>
            <%});%>
          </ul>
        </div>
      </div>
      <div class="col-md-10 col-sm-11 display-table-cell v-align">
        <div class="user-dashboard">
          </span
          ><span>Class code: </span><span>#</span><bold id="classcode"><%=id%></bold>
          <a href="/">Go back to sessions</a>
          <h1><%=name%></h1>
          <a href="" class="btn btn-outline-primary" id="runcode">Run code</a>
          <!-- code goes here -->
          <hr>
          <div class="codebar">
            <var id="filename"></var>
            <pre><code class="p-3 shadow" id="code" style="height: 500px !important; font-family:monospace;font-size: large;">Select file to open</code></pre>
          </div>
        </div>
      </div>
    </div>
  </div>
</body>
<script>
  $(document).ready(function () {
    $('[data-toggle="offcanvas"]').click(function () {
      $("#navigation").toggleClass("hidden-xs");
    });
  });
  function loadCode(element) {
    element.preventDefault
    element.classList.add("active")
    var xhr = new XMLHttpRequest()
    xhr.open("GET",`http://localhost:3000/class-data/<%=id%>/${element.textContent}`)

    xhr.onload = function(){
      if (this.status == 200){
        var obj =JSON.parse(this.response)
        var data = obj.data
        document.getElementById("code").innerText = data
        document.getElementById("filename").innerText = obj.filename
        if (obj.filename.includes(".html")){

          document.getElementById("runcode").href ="http://localhost:3000/run/"+obj.filename

          document.getElementById("code").classList.add("language-html")

          document.getElementById("code").classList.remove("language-css")
          document.getElementById("code").classList.remove("language-js")
          document.getElementById("code").classList.remove("language-py")
        }else if(obj.filename.includes(".css")){
          document.getElementById("code").classList.add("language-css")
          document.getElementById("code").classList.remove("language-html")
          document.getElementById("code").classList.remove("language-js")
          document.getElementById("code").classList.remove("language-py")
        }else if(obj.filename.includes(".js")){
          document.getElementById("code").classList.remove("language-css")
          document.getElementById("code").classList.remove("language-html")
          document.getElementById("code").classList.remove("language-py")
          document.getElementById("code").classList.add("language-js")
        }else if(obj.filename.includes(".py")){
          document.getElementById("code").classList.remove("language-css")
          document.getElementById("code").classList.remove("language-html")
          document.getElementById("code").classList.remove("language-js")
          document.getElementById("code").classList.add("language-py")
        }
        var element = document.querySelector(".codebar");
        var blocks = element.querySelectorAll('pre code');
        blocks.forEach(hljs.highlightBlock);
  
      }
    }
    xhr.send()
  }

</script>
